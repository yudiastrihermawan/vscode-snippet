{
  "javascript CRUD with DataTable": {
    "prefix": "js_crud_datatable",
    "body": [
      "$(document).ready(function() {",
      "// parameter",
      "var form = $('#form-${1}');",
      "var modal = $('#modal-${1}');",
      "var tambah = $('#btn-tambah');",
      "var simpan = $('#btn-simpan');",
      "var url_get = '<?php echo site_url('${1}/get') ?>';",
      "var url_store = '<?php echo site_url('${1}/store') ?>';",
      "var url_delete = '<?php echo site_url('${1}/delete') ?>';",
      "var table = $('#table-${1}');",
      "var table_reload = table.DataTable({",
      "ajax: {",
      "url: table.data('url'),",
      "type: 'POST'",
      "},",
      "// data dari database",
      "columns: [{",
      "data: 'id'",
      "},",
      "{",
      "data: 'field'",
      "},",
      "{",
      "render: function(data, type, row) {",
      "var html = '';",
      "html += '<button class=\"btn btn-info sunting\" data-id=\"' + row.id + '\" data-toggle=\"tooltip\" title=\"Sunting\"><i class=\"fa-solid fa-pen\"></i></button> ';",
      "html += '<button class=\"btn btn-danger hapus\" data-id=\"' + row.id + '\" data-toggle=\"tooltip\" title=\"Hapus\"><i class=\"fa-solid fa-trash\"></i></button> ';",
      "if (row.attachment != '') {",
      "html += '<a href=\"<?php echo base_url() ?>assets/files/' + row.attachment + '\" class=\"btn btn-warning btn-sm\"  data-toggle=\"tooltip\" title=\"Unduh\" target=\"_blank\"><i class=\"fa-solid fa-download\"></i></a>';",
      "}",
      "return html;",
      "},",
      "className: 'dt-center'",
      "}",
      "],",
      "drawCallback: function(settings) {",
      "$('[data-toggle=\"tooltip\"]').tooltip();",
      "},",
      "order: [",
      "[0, 'desc']",
      "],",
      "columnDefs: [{",
      "targets: [0],",
      "visible: false,",
      "},",
      "{",
      "targets: [-1],",
      "'orderable': false,",
      "}",
      "],",
      "language: {",
      "url: 'https://cdn.datatables.net/plug-ins/2.1.3/i18n/id.json',",
      "paginate: {",
      "first: '<i class=\"fa-solid fa-angles-left\"></i>',",
      "last: '<i class=\"fa-solid fa-angles-right\"></i>',",
      "next: '<i class=\"fa-solid fa-angle-right\"></i>',",
      "previous: '<i class=\"fa-solid fa-angle-left\"></i>',",
      "},",
      "},",
      "// processing: true,",
      "serverSide: true,",
      "// ordering: false,",
      "// info: false,",
      "});",
      "",
      "tambah.on('click', function(e) {",
      "e.preventDefault();",
      "form[0].reset();",
      "$('#title').text('Tambah');",
      "$('.help-block').empty();",
      "modal.modal('show');",
      "});",
      "",
      "table.on('click', '.sunting', function(e) {",
      "e.preventDefault();",
      "var id = $(this).data('id');",
      "$.post(url_get, {",
      "id: id",
      "}, function(o) {",
      "form[0].reset();",
      "$('#title').text('Sunting');",
      "$('.help-block').empty();",
      "$.each(o, function(key, val) {",
      "$('#' + key.replace('_', '-')).val(val);",
      "});",
      "modal.modal('show');",
      "}, 'json');",
      "});",
      "",
      "table.on('click', '.hapus', function(e) {",
      "e.preventDefault();",
      "var id = $(this).data('id');",
      "if (confirm('Apakah Anda yakin ingin menghapus dokumen ini?')) {",
      "$.post(url_delete, {",
      "id: id",
      "},",
      "function(data) {",
      "if (data.status == 'success') {",
      "toastr.success(data.message);",
      "table_reload.ajax.reload(null, false);",
      "} else {",
      "toastr.error(data.message);",
      "}",
      "}, 'json'",
      ");",
      "}",
      "});",
      "",
      "form.on('submit', function(e) {",
      "e.preventDefault();",
      "$.ajax({",
      "url: url_store,",
      "method: 'post',",
      "data: new FormData(this),",
      "dataType: 'json',",
      "contentType: false,",
      "cache: false,",
      "processData: false,",
      "beforeSend: function() {",
      "$('#title').append(' <small>Mohon tunggu ...</small>');",
      "simpan.attr('disabled', true);",
      "simpan.html('<i class=\"fa-solid fa-info\"></i> Melakukan proses');",
      "},",
      "success: function(data) {",
      "if (data.status == 'success') {",
      "toastr.success(data.message);",
      "table_reload.ajax.reload(null, false);",
      "modal.modal('hide');",
      "} else if (data.status == 'error') {",
      "if (data.message) {",
      "$('.help-block').empty();",
      "if (typeof data.message === 'object') {",
      "for (var key in data.message) {",
      "if (data.message.hasOwnProperty(key)) {",
      "$('#error-' + key).html(data.message[key]);",
      "}",
      "}",
      "} else {",
      "toastr.error(data.message);",
      "}",
      "} else {",
      "toastr.error('Terjadi kesalahan yang tidak diketahui.');",
      "}",
      "$('#title').append(' <small>Terjadi kesalahan.</small>');",
      "} else {",
      "toastr.error('Respon tidak valid dari server.');",
      "}",
      "simpan.attr('disabled', false);",
      "simpan.html('<i class=\"fa-solid fa-floppy-disk\"></i> Simpan');",
      "},",
      "error: function(jqXHR, textStatus, errorThrown) {",
      "toastr.error('Error berkomunikasi dengan server.')",
      "console.log(jqXHR);",
      "simpan.attr('disabled', false);",
      "simpan.html('<i class=\"fa-solid fa-floppy-disk\"></i> Simpan');",
      "}",
      "});",
      "});",
      "});"
    ],
    "description": "javascript CRUD with DataTable"
  }
}
